<html>
  <head>
    <title>Hyperbolic Cellular Automata Simulator</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" type="text/css" href="styles.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Dosis:wght@200..800&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <div id="header">
      <div id="variant-menu">
        <div class="dropdown">
          <button id="variant-button">
            <svg
              version="1.1"
              id="svg2"
              xmlns:dc="http://purl.org/dc/elements/1.1/"
              xmlns:cc="http://creativecommons.org/ns#"
              xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
              xmlns:svg="http://www.w3.org/2000/svg"
              xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
              xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
              sodipodi:docname="lines.svg"
              inkscape:version="0.48.4 r9939"
              xmlns="http://www.w3.org/2000/svg"
              xmlns:xlink="http://www.w3.org/1999/xlink"
              viewBox="0 0 1200 1200"
              enable-background="new 0 0 1200 1200"
              xml:space="preserve"
            >
              <path
                id="rect3039"
                inkscape:connector-curvature="0"
                d="M0,0v240h1200V0H0z M0,480v240h1200V480H0z M0,960v240h1200V960H0z"
              />
            </svg>
          </button>
          <div id="dropdown-content-1">
            <button id="btn-original" title="Play Conway's Game of Life" class="">
              Conway's Game of Life
            </button>
            <button id="btn-immigration" title="Play the Immigration Game" class="">
              Immigration Game
            </button>
            <button id="btn-rainbow" title="Play the Rainbow Game of Life" class="">
              Rainbow Game of Life
            </button>
          </div>
        </div>
        <div id="variant-name">Conway's Game of Life</div>
      </div>
      <div id="variant-menu-guide" class="hidden">
        <div class="guide-title">Variant Menu</div>
        <div class="guide-content">Conway</div>
        <div class="close-guide" id="close-variant-menu-guide">Close</div>
      </div>
      <div id="references">
        <button id="btn-guide">User Guide</button>
      </div>
    </div>

    <div id="main">
      <div id="main-row">
        <!--Main toolbar, containing most useful buttons-->
        <!-- other tools -->
        <div id="left-sidebar">
          <!-- misc status information -->
          <div id="save-load">
            <button id="btn-db-save" title="(Ctrl+S) Save state to the local database">Save</button>
            <button id="btn-db-load" title="(Ctrl+O) Load state from the local database">
              Open
            </button>
            <button id="btn-export-svg" title="Export image as SVG">SVG</button>
          </div>
          <div id="tiling-dash">
            <div id="tiling">
              Tiling
              <div id="tiling-input">
                &#123;&nbsp;
                <input id="entry-p" type="number" class="short" placeholder="p" />
                <input id="entry-q" type="number" class="short" placeholder="q" />
                &nbsp;&#125;
              </div>
              <button id="btn-set-grid" title="Apply this tiling">Set</button>
            </div>
          </div>
          <div id="tiling-guide" class="hidden">
            <div class="guide-title">Tiling Control</div>
            <div class="guide-content">
              Change the entries in the boxes to set the tiling {p,q} for the Poincaré Disk.
              <br /><br />
              Note that: <br />
              <span style="font-weight: bold">p</span> = the number of sides of the polygons <br />
              <span style="font-weight: bold">q</span> = the number of polygons that meet at a
              vertex.
            </div>
            <div class="close-guide" id="close-tiling">Close</div>
          </div>
          <div id="rules-dash">
            <div id="rules">
              <span id="controls-rule-simple">
                Rule<br />
                <div id="rule-variants">
                  <div id="rule-variant-labels">
                    <div id="rule-selction-label">Rule Selection</div>
                    <div id="updating-label">Updating</div>
                  </div>
                  <div id="rule-selection-menu">
                    <div class="dropdown">
                      <button id="rule-selection-button">Static</button>
                      <div id="dropdown-content-2">
                        <button id="btn-static" title="Use one rule only">Static</button>
                        <button id="btn-dynamic" title="Use multiple rules">Dynamic</button>
                      </div>
                    </div>
                    <div class="dropdown">
                      <button id="updating-button">Synchronous</button>
                      <div id="dropdown-content-3">
                        <button id="btn-synch" title="Update all cells simultaneously">
                          Synchronous
                        </button>
                        <button id="btn-asynch" title="Update cells individually">
                          Asynchronous
                        </button>
                      </div>
                    </div>
                  </div>
                </div>

                <div id="rules-container"><input id="rule-entry" placeholder="Rulestring" /></div>
                <div id="additional-rules-container" style="display: none">
                  <input id="rule-entry-1" placeholder="Rulestring 2" />
                  <input id="rule-entry-2" placeholder="Rulestring 3" />
                </div>

                <button id="btn-set-rule" title="Apply this rule">Set</button>
              </span>
              <!--For future clean-ups-->
              <span id="controls-rule-generic" style="display: none"> Generic rule<br /> </span>
            </div>
          </div>
          <div id="rules-guide" class="hidden">
            <div class="guide-title">Rule Control</div>
            <div class="guide-content">
              Choose the way rules are selected and how cells will be updated each after each
              generation and to choose the rule/s themselves.
            </div>
            <div class="close-guide" id="close-rules">Close</div>
          </div>

          <div id="save-load-guide" class="hidden">
            <div class="guide-title">Saving and Loading Patterns</div>
            <div class="guide-content">
              Save and access your generated patterns in a local database, and export the current
              state of the Poincaré Disk as an SVG file.
            </div>
            <div class="close-guide" id="close-save-load">Close</div>
          </div>

          <!--
          <div class="control-group">
            <button id="view-straighten" title="(Alt+S) Fix rotation and position of the view">
              Straighten view
            </button>
          </div>
          -->
          <div class="control-group" style="display: none">
            <button id="btn-mem-set" title="(M) Store field in the momory">MS</button>
            <button id="btn-mem-get" title="(U) Restore field from memory">MR</button>
            <button id="btn-mem-clear" title="(Alt+M) Clear memory">MC</button>
          </div>

          <div class="control-group" style="display: none">
            <button id="btn-search" title="(S) Search for all cell groups in the field">
              Search
            </button>
          </div>

          <div class="control-group" style="display: none">
            Export <br />
            <button id="btn-export" title="Export whole field to text">All</button>
            <button id="btn-exp-visible" title="Export visible part of the field to text">
              Visible
            </button>
          </div>

          <!--Animation (i don't get this)-->
          <div class="control-group" id="animate-controls" style="display: none">
            Upload animation<br />
            <input id="upload-name" type="text" value="frame-{0}.png" />

            <div class="control-table">
              <div>
                <div>Size:</div>
                <div>
                  <input
                    id="animate-size"
                    class="medium"
                    type="number"
                    value="640"
                    title="Image size in pixels"
                  />
                </div>
              </div>
              <div>
                <div>Steps:</div>
                <div>
                  <input
                    id="animate-generations"
                    class="medium"
                    type="number"
                    value="1"
                    title="How many generations to simulate for"
                  />
                </div>
              </div>
              <div>
                <div>Frames/step:</div>
                <div>
                  <input
                    id="animate-frame-per-generation"
                    class="medium"
                    type="number"
                    value="10"
                  />
                </div>
              </div>
            </div>
            <br />

            <div class="control-table">
              <div>
                <div>Start:</div>
                <div>
                  <button
                    id="animate-set-start"
                    title="Set initial position for animation. Hint: use straighten view button"
                  >
                    Set</button
                  ><button id="animate-view-start">View</button>
                </div>
              </div>
              <div>
                <div>End:</div>
                <div>
                  <button
                    id="animate-set-end"
                    title="Set final position for animation. Hint: use straighten view button"
                  >
                    Set</button
                  ><button id="animate-view-end">View</button>
                </div>
              </div>
            </div>
            <button
              id="btn-animate-derotate"
              title="Try to offset start and end points by equal amount so that translation metween them become straight path, and orient that path vertically. Useful for filming spaceships. Not always possible."
            >
              Derotate
            </button>
            <button id="btn-upload-animation">Upload animation</button>
            <button id="btn-animate-cancel" style="display: none" class="dangerous">
              Cancel upload
            </button>
          </div>
        </div>

        <!-- Main content -->
        <div id="main-content">
          <!-- Main control -->
          <div id="canvas-container" tabindex="0">
            <canvas id="canvas" width="600" height="600"></canvas>
          </div>
          <div id="canvas-guide" class="hidden">
            <div class="guide-title">Poincaré Disk</div>
            <div class="guide-content">
              This model is a two-dimensional visualization of the hyperbolic plane. It is the space
              where Conway's Game of Life is played.
            </div>
            <div class="close-guide" id="close-canvas">Close</div>
          </div>
        </div>
        <div id="toolbar">
          <div id="state-selector" style="display: none">
            <div>States</div>
            <span id="state-selector-buttons"></span>
          </div>

          <div class="button-group" id="rsg">
            <button id="btn-reset" class="dangerous" title="(C) Clear plane and reset view">
              <svg
                version="1.1"
                id="svg2"
                xmlns:dc="http://purl.org/dc/elements/1.1/"
                xmlns:cc="http://creativecommons.org/ns#"
                xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
                xmlns:svg="http://www.w3.org/2000/svg"
                xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
                sodipodi:docname="repeat.svg"
                inkscape:version="0.48.4 r9939"
                xmlns="http://www.w3.org/2000/svg"
                xmlns:xlink="http://www.w3.org/1999/xlink"
                viewBox="0 0 1200 1200"
                enable-background="new 0 0 1200 1200"
                xml:space="preserve"
              >
                <g id="SVGRepo_bgCarrier" stroke-width="0" />

                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round" />

                <g id="SVGRepo_iconCarrier">
                  <path
                    id="path18745"
                    inkscape:connector-curvature="0"
                    d="M600,0C268.629,0,0,268.629,0,600s268.629,600,600,600 c222.411,0,416.39-121.104,520.02-300.879L908.79,777.612C847.217,884.405,732.127,956.47,600,956.47 c-196.873,0-356.47-159.597-356.47-356.47S403.127,243.53,600,243.53c84.387,0,161.732,29.521,222.729,78.589L665.186,434.18 L1200,612.524V53.613l-174.17,123.926C917.124,67.952,766.553,0,600,0z"
                  />
                </g>
              </svg>
            </button>
            <button id="btn-play-start" title="(G or Space) Start continuous evolution of cells">
              <svg
                viewBox="-1 0 8 8"
                version="1.1"
                xmlns="http://www.w3.org/2000/svg"
                xmlns:xlink="http://www.w3.org/1999/xlink"
              >
                <g transform="translate(-427.000000, -3765.000000)">
                  <g id="icons" transform="translate(56.000000, 160.000000)">
                    <polygon id="play" points="371 3605 371 3613 378 3609"></polygon>
                  </g>
                </g>
              </svg>
            </button>
            <button
              id="btn-play-stop"
              style="display: none"
              class="button-active"
              title="(G or Space) Stop continuous evolution of cells"
            >
              <svg
                fill="#000000"
                width="250px"
                height="250px"
                viewBox="0 0 22 22"
                xmlns="http://www.w3.org/2000/svg"
                id="memory-pause"
                stroke="#000000"
                stroke-width="0.00022"
              >
                <g id="SVGRepo_bgCarrier" stroke-width="0" />

                <g
                  id="SVGRepo_tracerCarrier"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke="#CCCCCC"
                  stroke-width="0.308"
                />

                <g id="SVGRepo_iconCarrier">
                  <path d="M6 4H9V18H6V4M13 18V4H16V18H13Z" />
                </g>
              </svg>
            </button>
            <button id="btn-step" title="(N) Evolve cells for one generation">
              <svg
                version="1.1"
                id="svg2"
                xmlns:dc="http://purl.org/dc/elements/1.1/"
                xmlns:cc="http://creativecommons.org/ns#"
                xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
                xmlns:svg="http://www.w3.org/2000/svg"
                xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
                sodipodi:docname="step-forward.svg"
                inkscape:version="0.48.4 r9939"
                xmlns="http://www.w3.org/2000/svg"
                xmlns:xlink="http://www.w3.org/1999/xlink"
                width="800px"
                height="800px"
                viewBox="0 0 1200 1200"
                enable-background="new 0 0 1200 1200"
                xml:space="preserve"
              >
                <path
                  id="path22739"
                  inkscape:connector-curvature="0"
                  d="M950,0v1200H750V650l-500,500V50l500,500V0H950z"
                />
              </svg>
            </button>
            <div id="slider">
              <div id="speed">
                <span>Speed</span>
              </div>
              <input
                class="slider"
                type="range"
                orient="horizontal"
                min="0.25"
                max="4"
                value="1"
                step="0.25"
                oninput="rangeValue.innerText = this.value"
              />
              <div id="speed-value"><span id="rangeValue"> 1 </span><span>x</span></div>
            </div>
          </div>
          <div id="simulation-control-guide" class="hidden">
            <div class="guide-title">Simulator Control</div>
            <div class="guide-content">
              Change the entries in the boxes to set the tiling {p,q} for the Poincaré Disk.
              <br /><br />
              Note that: <br />
              <span style="font-weight: bold">p</span> = the number of sides of the polygons <br />
              <span style="font-weight: bold">q</span> = the number of polygons that meet at a
              vertex.
            </div>
            <div class="close-guide" id="close-simulation-control">Close</div>
          </div>
        </div>

        <div id="right-sidebar">
          <div class="button-group" id="disk-control">
            <!--<button
              id="btn-mode-edit"
              title="(E) Use left button to edit, middle or left+shift to pan"
            >-->
            <button id="btn-mode-edit" title="(E) Toggle initial population of cells">Edit</button>
            <!--<button
              id="btn-mode-pan"
              title="(P) Use left button to pan, middle or left+shift to edit"
            >-->
            <button id="btn-mode-pan" title="(P) Pan through the disk">Pan</button>
            <button id="btn-nav-home" title="(H) Navigate to the origin">Origin</button>
          </div>

          <div id="disk-control-guide" class="hidden">
            <div class="guide-title">Disk Control</div>
            <div class="guide-content">
              Change the entries in the boxes to set the tiling {p,q} for the Poincaré Disk.
              <br /><br />
              Note that: <br />
              <span style="font-weight: bold">p</span> = the number of sides of the polygons <br />
              <span style="font-weight: bold">q</span> = the number of polygons that meet at a
              vertex.
            </div>
            <div class="close-guide" id="close-disk-control">Close</div>
          </div>
          <div id="statusbar-dash">
            <div id="statusbar">
              <div class="control-table">
                <div>
                  <div>Neighbors:</div>
                  <div><span id="grid-num-neighbors" class="numdisplay"></span></div>
                </div>
                <div>
                  <div>Population:</div>
                  <div><span id="population" class="numdisplay"></span></div>
                </div>
                <div>
                  <div>Generation:</div>
                  <div><span id="generation" class="numdisplay"></span></div>
                </div>
              </div>
            </div>
          </div>
          <div id="statusbar-guide" class="hidden">
            <div class="guide-title">Simulation Data</div>
            <div class="guide-content">HI</div>
            <div class="close-guide" id="close-statusbar-guide">Close</div>
          </div>
          <div id="navigator-dash">
            <div id="navigator">
              <!--<button id="btn-nav-clear" style="display: none" title="Clear list of cell groups">
              Clear
            </button>-->
              <div id="navigator-wrap">
                Clusters
                <div id="navigator-cluster-list"></div>
              </div>
            </div>
          </div>

          <div id="navigator-guide" class="hidden">
            <div class="guide-title">Cluster Navigation</div>
            <div class="guide-content">Navigation</div>
            <div class="close-guide" id="close-navigator-guide">Close</div>
          </div>
        </div>
      </div>
    </div>

    <!-- popup dialogs ets -->

    <div id="export-dialog" style="display: none" class="popup-container">
      <div class="popup-shadow"></div>
      <div class="popup">
        <h1>Export data</h1>
        <textarea
          id="export"
          style="width: 100%"
          autocomplete="off"
          autocorrect="off"
          autocapitalize="off"
          spellcheck="false"
          class="code-entry"
        ></textarea>
        <div class="toolbar">
          <button id="btn-export-close">OK</button>
        </div>
      </div>
    </div>

    <div id="import-dialog" style="display: none" class="popup-container">
      <div class="popup-shadow"></div>
      <div class="popup">
        <h1>Import data</h1>
        <textarea
          id="import"
          style="width: 100%"
          height="50%"
          autocomplete="off"
          autocorrect="off"
          autocapitalize="off"
          spellcheck="false"
          class="code-entry"
        ></textarea>
        <div class="toolbar">
          <button id="btn-rainbow-run">OK</button>
          <button id="btn-rainbow-cancel">Cancel</button>
        </div>
      </div>
    </div>
    <!-- Dialog to load data to indexed DB -->
    <div id="file-dialog-open" style="display: none" class="popup-container">
      <div class="popup-shadow"></div>
      <div class="popup">
        <h1>Load from local database</h1>
        <div class="toolbar">
          Show Preset Catalogue: <button id="toggle-presets">Presets</button>
          Show My Catalogue:
          <button id="toggle-all-grids">All grids</button>
          <button id="toggle-all-rules">All rules</button>
        </div>
        <div id="file-dialog-files"></div>
        <div class="toolbar">
          <button id="btn-files-cancel">Cancel</button>
        </div>
      </div>
    </div>

    <!-- Dialog to save data to indexed DB -->
    <div id="file-dialog-save" style="display: none" class="popup-container">
      <div class="popup-shadow"></div>
      <div class="popup">
        <h1>Save to local database</h1>
        <div class="dialog-content">
          Save as:
          <input id="file-dialog-save-as" class="wide" value="" placeholder="Pattern Name" />
        </div>

        <div id="save-cancel">
          <button id="file-dialog-save-btn">Save</button>
          <button id="btn-files-save-cancel">Cancel</button>
        </div>
        <hr />
        <div id="file-dialog-save-files"></div>
      </div>
    </div>

    <!-- Dialog to save SVG -->
    <div id="svg-export-dialog" style="display: none" class="popup-container">
      <div class="popup-shadow"></div>
      <div class="popup">
        <h1>Export to SVG</h1>
        <div class="dialog-content">
          <div id="svg-image-container">[Image]</div>
        </div>
        <div class="toolbar">
          <button id="btn-svg-export-dialog-close">OK</button>
        </div>
      </div>
    </div>

    <script src="application.js"></script>
  </body>
</html>
